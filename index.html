<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TaskPet - Gestionnaire de T√¢ches avec Animal Virtuel</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3B82F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="TaskPet">
    
    <!-- React libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            overflow-x: hidden;
            background: #FFFFFF;
            touch-action: manipulation;
        }
        
        #root {
            width: 100%;
            min-height: 100vh;
            min-height: 100dvh;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #3B82F6, #10B981);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 9999;
        }
        
        .loading-logo {
            font-size: 64px;
            margin-bottom: 16px;
            animation: bounce 2s infinite;
        }
        
        .loading-text {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .loading-subtitle {
            font-size: 16px;
            opacity: 0.8;
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-15px,0); }
            70% { transform: translate3d(0,-7px,0); }
            90% { transform: translate3d(0,-2px,0); }
        }
        
        button, input, textarea, select {
            touch-action: manipulation;
        }
        
        @media (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>
<body>
    <div id="loading" class="loading-screen">
        <div class="loading-logo">üêâ</div>
        <div class="loading-text">TaskPet</div>
        <div class="loading-subtitle">Chargement de votre compagnon virtuel...</div>
    </div>
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect, useCallback } = React;

        // PWA Installation
        let deferredPrompt;

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    await navigator.serviceWorker.register('./sw.js');
                    console.log('SW enregistr√© avec succ√®s');
                } catch (error) {
                    console.log('√âchec enregistrement SW:', error);
                }
            });
        }

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        // Ic√¥nes
        const Icons = {
          Home: () => React.createElement('span', {style: {fontSize: '20px'}}, 'üè†'),
          Tasks: () => React.createElement('span', {style: {fontSize: '20px'}}, '‚úÖ'),
          Rewards: () => React.createElement('span', {style: {fontSize: '20px'}}, 'üéÅ'),
          Stats: () => React.createElement('span', {style: {fontSize: '20px'}}, 'üìä'),
          Profile: () => React.createElement('span', {style: {fontSize: '20px'}}, 'üë§'),
          Plus: () => React.createElement('span', {style: {fontSize: '18px'}}, '‚ûï'),
          Bell: () => React.createElement('span', {style: {fontSize: '18px'}}, 'üîî'),
          Search: () => React.createElement('span', {style: {fontSize: '18px'}}, 'üîç'),
          X: () => React.createElement('span', {style: {fontSize: '18px'}}, '‚ùå'),
          Settings: () => React.createElement('span', {style: {fontSize: '18px'}}, '‚öôÔ∏è'),
          Trophy: () => React.createElement('span', {style: {fontSize: '18px'}}, 'üèÜ'),
          Coins: () => React.createElement('span', {style: {fontSize: '18px'}}, 'ü™ô'),
          Edit: () => React.createElement('span', {style: {fontSize: '18px'}}, '‚úèÔ∏è'),
          Trash: () => React.createElement('span', {style: {fontSize: '18px'}}, 'üóëÔ∏è'),
          Play: () => React.createElement('span', {style: {fontSize: '18px'}}, '‚ñ∂Ô∏è'),
          Check: () => React.createElement('span', {style: {fontSize: '18px'}}, '‚úì'),
          Gift: () => React.createElement('span', {style: {fontSize: '18px'}}, 'üéÅ'),
        };

        // Donn√©es avec localStorage
        const getStoredData = (key, defaultValue) => {
            try {
                const stored = localStorage.getItem(key);
                return stored ? JSON.parse(stored) : defaultValue;
            } catch {
                return defaultValue;
            }
        };

        const setStoredData = (key, value) => {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (e) {
                console.warn('Impossible de sauvegarder:', e);
            }
        };

        const defaultPets = [
          { id: 'drizzle', name: 'Drizzle', image: 'üêâ', description: 'Un dragon compagnon amical' },
          { id: 'bumblebun', name: 'Bumblebun', image: 'üê∞', description: 'Un lapin joyeux' },
          { id: 'sparkle', name: 'Sparkle', image: 'ü¶Ñ', description: 'Une licorne magique' },
          { id: 'whiskers', name: 'Whiskers', image: 'üê±', description: 'Un chaton joueur' },
        ];

        const defaultTasks = [
          { id: '1', title: 'Faire du sport le matin', category: 'sant√©', completed: false, priority: 'high' },
          { id: '2', title: 'R√©viser le projet', category: 'travail', completed: false, priority: 'medium' },
          { id: '3', title: 'Appeler maman', category: 'personnel', completed: true, priority: 'low' },
          { id: '4', title: 'Faire les courses', category: 'courses', completed: false, priority: 'high' },
        ];

        function TaskPetApp() {
          // Masquer l'√©cran de chargement
          useEffect(() => {
            const timer = setTimeout(() => {
              const loading = document.getElementById('loading');
              if (loading) {
                loading.style.opacity = '0';
                loading.style.transition = 'opacity 0.5s ease-out';
                setTimeout(() => loading.remove(), 500);
              }
            }, 1500);
            return () => clearTimeout(timer);
          }, []);

          // √âtats
          const [currentTab, setCurrentTab] = useState('home');
          const [user, setUser] = useState(() => 
            getStoredData('taskpet_user', { name: 'Joueur', coins: 150, level: 5, streak: 7 })
          );
          const [currentPet, setCurrentPet] = useState(() => 
            getStoredData('taskpet_pet', defaultPets[0])
          );
          const [tasks, setTasks] = useState(() => 
            getStoredData('taskpet_tasks', defaultTasks)
          );
          const [darkMode, setDarkMode] = useState(false);
          const [showInstallModal, setShowInstallModal] = useState(false);

          // Sauvegarde
          useEffect(() => setStoredData('taskpet_user', user), [user]);
          useEffect(() => setStoredData('taskpet_pet', currentPet), [currentPet]);
          useEffect(() => setStoredData('taskpet_tasks', tasks), [tasks]);

          // Couleurs
          const colors = {
            primary: '#3B82F6',
            background: darkMode ? '#111827' : '#FFFFFF',
            surface: darkMode ? '#1F2937' : '#F8FAFC',
            text: darkMode ? '#F9FAFB' : '#1F2937',
            textSecondary: darkMode ? '#9CA3AF' : '#64748B',
            border: darkMode ? '#374151' : '#E2E8F0',
            success: '#10B981',
          };

          // Gestionnaires
          const handleFeedPet = () => {
            if (user.coins >= 10) {
              setUser(prev => ({ ...prev, coins: prev.coins - 10 }));
              alert(`Animal nourri ! ${currentPet.name} est content ! ü•∞`);
            } else {
              alert('Pas assez de pi√®ces !');
            }
          };

          const handleTaskToggle = (taskId) => {
            setTasks(prev => prev.map(task => 
              task.id === taskId ? { ...task, completed: !task.completed } : task
            ));
          };

          // Installation PWA
          const handleInstallPWA = async () => {
            if (deferredPrompt) {
              deferredPrompt.prompt();
              const { outcome } = await deferredPrompt.userChoice;
              if (outcome === 'accepted') {
                setShowInstallModal(false);
              }
              deferredPrompt = null;
            }
          };

          // Styles
          const styles = {
            container: {
              minHeight: '100vh',
              backgroundColor: colors.background,
              fontFamily: 'system-ui, sans-serif',
            },
            tabBar: {
              position: 'fixed',
              bottom: 0,
              left: 0,
              right: 0,
              display: 'flex',
              backgroundColor: colors.surface,
              borderTop: `1px solid ${colors.border}`,
              padding: '8px',
              zIndex: 1000,
            },
            tabItem: {
              flex: 1,
              display: 'flex',
              flexDirection: 'column',
              alignItems: 'center',
              padding: '12px',
              cursor: 'pointer',
              borderRadius: '12px',
              margin: '0 4px',
            },
            tabItemActive: {
              backgroundColor: colors.primary + '20',
            },
            screen: {
              paddingBottom: '80px',
              padding: '20px',
            },
            section: {
              backgroundColor: colors.surface,
              borderRadius: '16px',
              padding: '20px',
              marginBottom: '20px',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
            },
            petCard: {
              display: 'flex',
              alignItems: 'center',
              marginBottom: '20px',
            },
            petEmoji: {
              fontSize: '48px',
              marginRight: '16px',
            },
            petName: {
              fontSize: '24px',
              fontWeight: 'bold',
              color: colors.text,
            },
            quickActionsGrid: {
              display: 'grid',
              gridTemplateColumns: 'repeat(2, 1fr)',
              gap: '12px',
            },
            actionButton: {
              padding: '16px',
              borderRadius: '12px',
              border: 'none',
              cursor: 'pointer',
              display: 'flex',
              flexDirection: 'column',
              alignItems: 'center',
              fontSize: '16px',
              fontWeight: '600',
              color: '#fff',
            },
            taskItem: {
              display: 'flex',
              alignItems: 'center',
              padding: '12px',
              borderBottom: `1px solid ${colors.border}`,
            },
            checkbox: {
              width: '24px',
              height: '24px',
              borderRadius: '12px',
              border: `2px solid ${colors.border}`,
              marginRight: '12px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              cursor: 'pointer',
            },
            checkboxChecked: {
              backgroundColor: colors.success,
              borderColor: colors.success,
              color: '#fff',
            },
            taskTitle: {
              flex: 1,
              color: colors.text,
            },
            taskTitleCompleted: {
              textDecoration: 'line-through',
              opacity: 0.6,
            },
          };

          // Navigation
          const TabBar = () => (
            React.createElement('div', { style: styles.tabBar },
              [
                { id: 'home', name: 'Accueil', icon: Icons.Home },
                { id: 'tasks', name: 'T√¢ches', icon: Icons.Tasks },
                { id: 'rewards', name: 'R√©compenses', icon: Icons.Rewards },
                { id: 'stats', name: 'Stats', icon: Icons.Stats },
                { id: 'profile', name: 'Profil', icon: Icons.Profile },
              ].map(tab => (
                React.createElement('div', {
                  key: tab.id,
                  style: {
                    ...styles.tabItem,
                    ...(currentTab === tab.id ? styles.tabItemActive : {}),
                  },
                  onClick: () => setCurrentTab(tab.id)
                },
                  React.createElement(tab.icon),
                  React.createElement('div', { 
                    style: { 
                      fontSize: '11px', 
                      marginTop: '4px',
                      color: currentTab === tab.id ? colors.primary : colors.textSecondary 
                    }
                  }, tab.name)
                )
              ))
            )
          );

          // √âcrans
          const HomeScreen = () => (
            React.createElement('div', { style: styles.screen },
              React.createElement('h1', { 
                style: { fontSize: '28px', fontWeight: 'bold', marginBottom: '20px', color: colors.text }
              }, 'TaskPet'),
              
              // Banni√®re d'installation
              deferredPrompt && React.createElement('div', {
                style: {
                  backgroundColor: colors.primary + '20',
                  padding: '12px',
                  borderRadius: '12px',
                  marginBottom: '20px',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                }
              },
                React.createElement('div', null,
                  React.createElement('div', { style: { fontWeight: '600', color: colors.text } }, 'Installer TaskPet'),
                  React.createElement('div', { style: { fontSize: '12px', color: colors.textSecondary } }, 'Acc√®s hors-ligne')
                ),
                React.createElement('button', {
                  style: {
                    backgroundColor: colors.primary,
                    color: '#fff',
                    border: 'none',
                    padding: '8px 16px',
                    borderRadius: '8px',
                    cursor: 'pointer',
                  },
                  onClick: handleInstallPWA
                }, 'Installer')
              ),

              React.createElement('div', { style: styles.section },
                React.createElement('div', { style: styles.petCard },
                  React.createElement('div', { style: styles.petEmoji }, currentPet.image),
                  React.createElement('div', null,
                    React.createElement('div', { style: styles.petName }, currentPet.name),
                    React.createElement('div', { style: { color: colors.textSecondary } }, currentPet.description)
                  )
                ),
                React.createElement('div', { style: styles.quickActionsGrid },
                  React.createElement('button', {
                    style: { ...styles.actionButton, backgroundColor: colors.success },
                    onClick: handleFeedPet
                  },
                    React.createElement('div', { style: { fontSize: '24px', marginBottom: '8px' } }, 'üçé'),
                    'Nourrir (10 ü™ô)'
                  ),
                  React.createElement('button', {
                    style: { ...styles.actionButton, backgroundColor: colors.primary },
                    onClick: () => alert('Jeu en cours de d√©veloppement !')
                  },
                    React.createElement('div', { style: { fontSize: '24px', marginBottom: '8px' } }, 'üéÆ'),
                    'Mini-Jeux'
                  )
                )
              ),

              React.createElement('div', { style: styles.section },
                React.createElement('h3', { style: { marginBottom: '16px', color: colors.text } }, 'Statistiques'),
                React.createElement('div', { style: { display: 'flex', gap: '16px' } },
                  React.createElement('div', { style: { textAlign: 'center', flex: 1 } },
                    React.createElement('div', { style: { fontSize: '24px', fontWeight: 'bold', color: colors.text } }, user.coins),
                    React.createElement('div', { style: { fontSize: '12px', color: colors.textSecondary } }, 'Pi√®ces')
                  ),
                  React.createElement('div', { style: { textAlign: 'center', flex: 1 } },
                    React.createElement('div', { style: { fontSize: '24px', fontWeight: 'bold', color: colors.text } }, user.level),
                    React.createElement('div', { style: { fontSize: '12px', color: colors.textSecondary } }, 'Niveau')
                  ),
                  React.createElement('div', { style: { textAlign: 'center', flex: 1 } },
                    React.createElement('div', { style: { fontSize: '24px', fontWeight: 'bold', color: colors.text } }, user.streak),
                    React.createElement('div', { style: { fontSize: '12px', color: colors.textSecondary } }, 'S√©rie')
                  )
                )
              )
            )
          );

          const TasksScreen = () => (
            React.createElement('div', { style: styles.screen },
              React.createElement('h1', { 
                style: { fontSize: '28px', fontWeight: 'bold', marginBottom: '20px', color: colors.text }
              }, 'Mes T√¢ches'),
              React.createElement('div', { style: styles.section },
                tasks.map(task => (
                  React.createElement('div', {
                    key: task.id,
                    style: styles.taskItem
                  },
                    React.createElement('div', {
                      style: {
                        ...styles.checkbox,
                        ...(task.completed ? styles.checkboxChecked : {})
                      },
                      onClick: () => handleTaskToggle(task.id)
                    },
                      task.completed && React.createElement(Icons.Check)
                    ),
                    React.createElement('div', {
                      style: {
                        ...styles.taskTitle,
                        ...(task.completed ? styles.taskTitleCompleted : {})
                      }
                    }, task.title)
                  )
                ))
              )
            )
          );

          const OtherScreen = ({ title }) => (
            React.createElement('div', { style: styles.screen },
              React.createElement('h1', { 
                style: { fontSize: '28px', fontWeight: 'bold', marginBottom: '20px', color: colors.text }
              }, title),
              React.createElement('div', { style: styles.section },
                React.createElement('p', { style: { color: colors.textSecondary } }, 
                  'Cette section sera d√©velopp√©e prochainement !'
                )
              )
            )
          );

          // Rendu principal
          const renderScreen = () => {
            switch (currentTab) {
              case 'home': return React.createElement(HomeScreen);
              case 'tasks': return React.createElement(TasksScreen);
              case 'rewards': return React.createElement(OtherScreen, { title: 'R√©compenses' });
              case 'stats': return React.createElement(OtherScreen, { title: 'Statistiques' });
              case 'profile': return React.createElement(OtherScreen, { title: 'Profil' });
              default: return React.createElement(HomeScreen);
            }
          };

          return React.createElement('div', { style: styles.container },
            renderScreen(),
            React.createElement(TabBar)
          );
        }

        // Rendu de l'application
        ReactDOM.render(React.createElement(TaskPetApp), document.getElementById('root'));
    </script>
</body>
</html>